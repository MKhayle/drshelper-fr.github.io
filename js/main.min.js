"use strict";var VIVI,ARENA,timerHOTCOLD,timerBRAND,timerDEBUFF,SPEED=1e3;const VIVIS=["vivi-win","vivi-dead"],VIVIS2=["vivi-ans","vivi-win","vivi-dead","vivi-south"],TA=["bosse"],CLONES=["bossn","bossw","bosss"],BOSSES=TA.concat(CLONES),METERS=["meter-2","meter-1","meter1","meter2"],SWORDS=["swordn","sworde","swordw","swords"],STATUS={win:"You resolved everything correctly and lived! Great job!",dead:"You failed to neutralize your temperature and got KO’d&nbsp;:(",sword:"You got hit by two swords at once!",burned:"Your body went above 2 levels and burned to death!",froze:"Your body went below 2 levels and froze to death!"},SETTINGS={timer:!0,safe:!0,init:function(){this.timer=d3.select("#formTimer").property("checked"),this.safe=d3.select("#formSafe").property("checked"),this.timer,SPEED=1e3}};class Vivi{constructor(e,t){this.hotcold=e,this.brand=t,this.body=e,this.pos="tile12",this.show()}set pos(e){this.tile=e,this.x=parseInt(e.slice(4,5)),this.y=parseInt(e.slice(5))}show(){vis("vivi-ans"),vis("vivi-south")}win(){invis("vivi-south"),vis("vivi-win")}dead(){invis("vivi-south"),vis("vivi-dead"),show("btnPractiseAgain")}move(e,t){move("vivi-ans",e,t)}sword(e){let t,s,r=this.x,i=this.y;1===e?(t=ARENA.hits1,s=ARENA.temps1):(t=ARENA.hits2,s=ARENA.temps2),t[i][r]>1?(endPractice(),this.dead(),updateStatus("You got hit by two swords at once!")):this.check(s[i][r])}check(e){let t=this.body+e;t>2||t<-2?(endPractice(),this.dead(),updateStatus(t>2?"Your body went above 2 levels and burned to death!":"Your body went below 2 levels and froze to death!")):(this.life(t),this.body=t,levelTemp(e))}life(e){let t=this.body;vis("ta-life"),hide("dbf-hc"+t),hide("life"+t),show("dbf-hc"+e),show("life"+e)}}class Arena{constructor(e,t,s,r){this.safe1=e,this.safe2=t,this.meters1=s,this.meters2=r,this.showSafe=SETTINGS.safe,this.init(),this.rotateAll(0)}init(){let[e,t]=[this.safe1,this.safe2],[s,r]=[this.meters1,this.meters2];this.orients1=this.setOrients(e),this.orients2=this.setOrients(t),this.swords1=this.setSwords(e),this.swords2=this.setSwords(t),this.hits1=this.setHits(e),this.hits2=this.setHits(t),this.temps1=this.setHits(e,s),this.temps2=this.setHits(t,r)}setOrients(e){const t=(()=>getRand("n","s"))(),s=(()=>getRand("e","w"))();return[3===e||4===e?t:s,2===e||3===e?t:s,1===e||4===e?t:s,1===e||2===e?t:s]}setSwords(e){let t=[];switch(e){case 1:t=["swordn","swords","swordw","sworde"];break;case 2:t=["swordn","sworde","swords","swordw"];break;case 3:t=["swordw","sworde","swordn","swords"];break;case 4:default:t=["sworde","swordn","swordw","swords"]}return t}setHits(e,t=[1,1,1,1]){let s=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],r=[];switch(e){case 1:r=["sm-n","bg-s","sm-w","bg-e"];break;case 2:r=["sm-n","sm-e","bg-s","bg-w"];break;case 3:r=["bg-w","sm-e","bg-n","sm-s"];break;default:r=["bg-e","bg-n","sm-w","sm-s"]}for(let e=0;e<s.length;e++)for(let i=0;i<s[e].length;i++)for(let o=0;o<r.length;o++)switch(r[o]){case"bg-n":e<2&&(s[e][i]+=t[o]);break;case"bg-e":i>1&&(s[e][i]+=t[o]);break;case"bg-w":i<2&&(s[e][i]+=t[o]);break;case"bg-s":e>1&&(s[e][i]+=t[o]);break;case"sm-n":e<1&&(s[e][i]+=t[o]);break;case"sm-e":i>2&&(s[e][i]+=t[o]);break;case"sm-w":i<1&&(s[e][i]+=t[o]);break;case"sm-s":e>2&&(s[e][i]+=t[o]);break;default:s[e][i]=8}return s}color(e,t=!1){let s,r,i=1===e?this.hits1:this.hits2;for(let e=0;e<4;e++)for(let o=0;o<4;o++){if(t)r="honeydew";else{if(0===(s=i[o][e]))continue;r=2===s?"sandybrown":"#fad2b0"}d3.select("#bg"+e+o).style("fill",r)}if(!t)return setTimeout(this.color,SPEED,e,!0)}clones(){for(let e of CLONES)vis(e)}rotateAll(e=0){let t=[],s=["n","e","w","s"];switch(e){case 1:t=this.orients1;break;case 2:t=this.orients2;break;default:t=new Array(4).fill("s")}for(let e=0;e<s.length;e++)this.rotate(s[e],t[e])}rotate(e,t){let s;switch(t){case"n":s=180;break;case"e":s=270;break;case"w":s=90;break;case"s":default:s=0}d3.select("#face"+e).attr("transform","translate(17, 17) rotate("+s+") translate(-17, -17)")}meters(e){let t=1===e?this.meters1:this.meters2;move("meter"+t[0],73,26),move("meter"+t[1],113,66),move("meter"+t[2],33,66),move("meter"+t[3],73,106);for(let e of METERS)vis(e)}swords(e){let t,s,r,i;switch(1===e?(t=this.swords1,s=this.meters1):(t=this.swords2,s=this.meters2),t.indexOf("swordn")){case 0:[r,i]=[87,10.5];break;case 1:[r,i]=[127,50.5];break;default:[r,i]=[39,50.5]}switch(move("swordn",r,i),t.indexOf("sworde")){case 0:[r,i]=[95.5,39];break;case 1:[r,i]=[135.5,79];break;default:[r,i]=[95.5,127]}switch(move("sworde",r,i),t.indexOf("swordw")){case 0:[r,i]=[50.5,39];break;case 2:[r,i]=[10.5,79];break;default:[r,i]=[50.5,127]}switch(move("swordw",r,i),t.indexOf("swords")){case 1:[r,i]=[127,95.5];break;case 2:[r,i]=[39,95.5];break;default:[r,i]=[87,135.5]}move("swords",r,i);for(let e=0;e<SWORDS.length;e++)d3.select("#"+t[e]).styles({fill:s[e]>0?"#f08080":"#87cefa",stroke:s[e]>0?"#531515":"#4668a6"}),vis(SWORDS[e])}}function setGame(){let e,t,s,r,i,o,a;const n=[-2,-1,1,2],d=[1,2,3,4],l=e=>{let t=e.slice();for(let e=t.length-1;e>0;e--){let s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t};for(e=getRand(...n),t=getRand(...n);e+t===0;)t=getRand(...n);for(s=getRand(...d),r=getRand(...d);s===r;)r=getRand(...d);i=l(n);do{a=!1,o=l(n);for(let e=0;e<n.length;e++)if(i[e]===o[e]){a=!0;break}}while(a);VIVI=new Vivi(e,t),ARENA=new Arena(s,r,i,o),hide("dbf-intemp"),hide("dbf-hc0"),hide("life0");for(let e of n)hide("dbf-hc"+e),hide("dbf-eb"+e),hide("life"+e)}function startPractice(){SETTINGS.init(),setGame(),hide("settings"),show("info"),addOptions(),vis("bosse"),SETTINGS.timer?castDebuff("Hot and Cold"):(show("btnResolveSwords1"),show("dbf-intemp"),show("dbf-eb"+VIVI.brand),VIVI.life(VIVI.body),levelTemp(VIVI.hotcold),ARENA.clones(),ARENA.rotateAll(1),ARENA.meters(1),ARENA.swords(1))}function btnResolveSwords1(){updateStatus(),ARENA.color(1),setTimeout(function(){hide("btnResolveSwords1"),VIVI.sword(1),VIVI.body>=-2&&VIVI.body<=2?(ARENA.rotateAll(2),ARENA.meters(2),ARENA.swords(2),show("btnResolveSwords2")):show("btnPractiseAgain")},SPEED)}function btnResolveSwords2(){updateStatus(),ARENA.color(2),setTimeout(function(){hide("btnResolveSwords2"),VIVI.sword(2),VIVI.body>=-2&&VIVI.body<=2?(removeOptions(),resetThis(METERS,SWORDS),show("btnResolveBrand")):show("btnPractiseAgain")},SPEED)}function btnResolveBrand(){let e=VIVI.brand;hide("btnResolveBrand"),show("btnPractiseAgain"),resetThis(CLONES),VIVI.check(e),hide("dbf-eb"+e),0===VIVI.body?(VIVI.win(),updateStatus("You resolved everything correctly and lived! Great job!")):(VIVI.dead(),updateStatus("You failed to neutralize your temperature and got KO’d&nbsp;:("))}function startTimerHotCold(){let e=d3.select("#txt-hotcold"),t=49;e.text(t),show("dbf-intemp"),VIVI.life(VIVI.body),timerHOTCOLD=setInterval(function(){switch(t--,e.text(t),t){case 0:clearInterval(timerHOTCOLD),e.html("&nbsp;"),0===VIVI.body?(VIVI.win(),updateStatus("You resolved everything correctly and lived! Great job!")):(VIVI.dead(),updateStatus("You failed to neutralize your temperature and got KO’d :("));break;case 7:removeOptions(),VIVI.sword(2);break;case 8:ARENA.color(2);break;case 17:castDebuff("Blade of Entropy",10),ARENA.meters(2),ARENA.swords(2);break;case 18:ARENA.rotateAll(2);break;case 20:VIVI.sword(1);break;case 21:ARENA.color(1);break;case 30:castDebuff("Blade of Entropy",10),ARENA.meters(1),ARENA.swords(1);break;case 31:ARENA.rotateAll(1);break;case 38:castDebuff("Unwavering Apparition");break;case 46:castDebuff("Elemental Brand")}},SPEED)}function startTimerBrand(){let e=d3.select("#txt-brand"),t=38,s=VIVI.brand;e.text(t),show("dbf-eb"+s),timerBRAND=setInterval(function(){t--,e.text(t),t<=0&&(clearInterval(timerBRAND),show("btnPractiseAgain"),VIVI.check(s),(VIVI.body>=-2||VIVI.body<=2)&&(resetThis(CLONES),hide("dbf-eb"+s),levelTemp(s)),e.html("&nbsp;"))},SPEED)}function castDebuff(e,t=4){updateStatus("Casting <b>"+e+"</b> in... "+t),timerDEBUFF=setInterval(function(){if(--t<=0){switch(e){case"Blade of Entropy":resetThis(METERS,SWORDS);break;case"Unwavering Apparition":ARENA.clones(),updateStatus();break;case"Elemental Brand":startTimerBrand(),updateStatus();break;case"Hot and Cold":startTimerHotCold(),levelTemp(VIVI.hotcold)}clearInterval(timerDEBUFF)}else updateStatus("Casting <b>"+e+"</b> in... "+t)},SPEED)}function addOptions(){options(clickTile)}function removeOptions(){options(null)}function options(e){for(let t=0;t<4;t++)for(let s=0;s<4;s++)d3.select("#tile"+t+s).on("click",e)}function clickTile(){VIVI.pos=this.id,VIVI.move(40*VIVI.x+18,40*VIVI.y+16),VIVI.show()}function endPractice(){removeOptions(),clearInterval(timerHOTCOLD),d3.select("#txt-hotcold").html("&nbsp;"),clearInterval(timerBRAND),d3.select("#txt-brand").html("&nbsp;"),clearInterval(timerDEBUFF),resetGlobals()}function practiseAgain(){hide("btnPractiseAgain"),endPractice(),resetBoard(),startPractice()}function resetGlobals(){VIVI="",ARENA="",timerHOTCOLD="",timerBRAND="",timerDEBUFF=""}function resetThis(...e){let t;for(let s of e){t=s;for(let e of t)invis(e)}}function getRand(...e){return e[Math.floor(Math.random()*e.length)]}function move(e,t,s){d3.select("#"+e).attr("transform","translate("+t+", "+s+")")}function invis(e){d3.select("#"+e).classed("invisible",!0)}function vis(e){d3.select("#"+e).classed("invisible",!1)}function hide(e){d3.select("#"+e).classed("hidden",!0)}function show(e){d3.select("#"+e).classed("hidden",!1)}function updateStatus(e="&nbsp;"){write("status",e)}function write(e,t){d3.select("#"+e).html(t)}function levelTemp(e){let t;switch(e){case 0:return void updateStatus();case-2:t="falls 2 levels.";break;case-1:t="falls 1 level.";break;case 1:t="rises 1 level.";break;case 2:default:t="rises 2 levels."}updateStatus("<i>Your body temperature "+t+"</i>")}function resetBoard(){resetThis(VIVIS,BOSSES,METERS,SWORDS)}resetBoard(),startPractice();