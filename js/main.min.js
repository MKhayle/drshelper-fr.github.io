"use strict";var VIVI,ARENA,SPEED,timerHOTCOLD,timerBRAND,timerMECHANIC;const THERMOMETERS=["meter-2","meter-1","meter1","meter2"],SWORDS=["swordn","sworde","swordw","swords"];class Vivi{constructor(a,b){this.hotcold=a,this.brand=b,this.bodyTemp=a,this.position="tile12"}set position(a){this.tile=a,this.x=parseInt(a.slice(4,5)),this.y=parseInt(a.slice(5))}win(){hide("vivi-south"),show("vivi-win"),updateStatus("You resolved everything correctly and lived! Great job!")}dead(a="You failed to neutralize your temperature and got KO\u2019d&nbsp;:("){hide("vivi-south"),show("vivi-dead"),removeOptions(),clearInterval(timerHOTCOLD),write("txt-hotcold"),clearInterval(timerBRAND),write("txt-brand"),clearInterval(timerMECHANIC),updateStatus(a)}sword(a){let b=this.x,c=this.y;ARENA[`hits${a}`][c][b]>1?(this.dead("You got hit by two swords at once!"),this.bodyTemp=100):this.check(ARENA[`temps${a}`][c][b])}check(b){let a=this.bodyTemp+b;a>2||a< -2?(this.bodyTemp=a,a>2?this.dead("Your body temperature went above 2 levels and burned to death!"):this.dead("Your body temperature went below 2 levels and froze to death!")):(this.showLife(a),this.bodyTemp=a,writeTempChange(b))}showLife(a){show("ta-life"),hide(`dbf-hc${this.bodyTemp}`),hide(`life${this.bodyTemp}`),show(`dbf-hc${a}`),show(`life${a}`)}}class Arena{constructor(a,b,c,d){this.safe1=a,this.safe2=b,this.meters1=c,this.meters2=d,this.orients1=this.setOrients(a),this.orients2=this.setOrients(b),this.swords1=this.setSwords(a),this.swords2=this.setSwords(b),this.hits1=this.setHits(a),this.hits2=this.setHits(b),this.temps1=this.setHits(a,c),this.temps2=this.setHits(b,d)}colorTiles(d,e=!1){let g=this[`hits${d}`],f,c;for(let a=0;a<4;a++)for(let b=0;b<4;b++){if(e)c="ivory";else{if(0===(f=g[b][a]))continue;c=2===f?"sandybrown":"peachpuff"}d3.select(`#bg${a}${b}`).style("fill",c)}if(!e)return setTimeout(this.colorTiles,SPEED,d,!0)}showClones(){this.clones(showAll)}hideClones(){this.clones(hideAll)}clones(a){a(["bossn","bossw","bosss"])}rotateBosses(d){let a,e=this[`orients${d}`],c=["n","e","w","s"];for(let b=0;b<c.length;b++){switch(e[b]){case"n":a=180;break;case"e":a=270;break;case"w":a=90;break;default:a=0}d3.select(`#face${c[b]}`).attr("transform",`translate(17, 17) rotate(${a}) translate(-17, -17)`)}}meters(b){let a=this[`meters${b}`];move(`meter${a[0]}`,73,26),move(`meter${a[1]}`,113,66),move(`meter${a[2]}`,33,66),move(`meter${a[3]}`,73,106),showAll(THERMOMETERS)}swords(e){let d=this[`swords${e}`],f=this[`meters${e}`],a,b;switch(d.indexOf("swordn")){case 0:[a,b]=[87,10.5];break;case 1:[a,b]=[127,50.5];break;default:[a,b]=[39,50.5]}switch(move("swordn",a,b),d.indexOf("sworde")){case 0:[a,b]=[95.5,39];break;case 1:[a,b]=[135.5,79];break;default:[a,b]=[95.5,127]}switch(move("sworde",a,b),d.indexOf("swordw")){case 0:[a,b]=[50.5,39];break;case 2:[a,b]=[10.5,79];break;default:[a,b]=[50.5,127]}switch(move("swordw",a,b),d.indexOf("swords")){case 1:[a,b]=[127,95.5];break;case 2:[a,b]=[39,95.5];break;default:[a,b]=[87,135.5]}move("swords",a,b);for(let c=0;c<SWORDS.length;c++)d3.select(`#${d[c]}`).styles({fill:f[c]>0?"#f08080":"#87cefa",stroke:f[c]>0?"#531515":"#4668a6"}),show(SWORDS[c])}showSwords(a){this.meters(a),this.swords(a),sessionStorage.getItem("formMarkSafe")&&show(`tilesafe${this[`safe${a}`]}`)}hideSwords(){hideAll(THERMOMETERS),hideAll(SWORDS),hideAll([`tilesafe${this.safe1}`,`tilesafe${this.safe2}`])}setOrients(f){let a=(a,b)=>f===a||f===b?getRandItem(["n","s"]):getRandItem(["e","w"]),b=a(3,4),c=a(2,3),d=a(1,4),e=a(1,2);return[b,c,d,e]}setSwords(b){let a=[];switch(b){case 1:a=["swordn","swords","swordw","sworde"];break;case 2:a=["swordn","sworde","swords","swordw"];break;case 3:a=["swordw","sworde","swordn","swords"];break;default:a=["sworde","swordn","swordw","swords"]}return a}setHits(g,e=[1,1,1,1]){let c=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],f=[];switch(g){case 1:f=["sm-n","bg-s","sm-w","bg-e"];break;case 2:f=["sm-n","sm-e","bg-s","bg-w"];break;case 3:f=["bg-w","sm-e","bg-n","sm-s"];break;default:f=["bg-e","bg-n","sm-w","sm-s"]}for(let a=0;a<c.length;a++)for(let b=0;b<c[a].length;b++)for(let d=0;d<f.length;d++)switch(f[d]){case"bg-n":a<2&&(c[a][b]+=e[d]);break;case"bg-e":b>1&&(c[a][b]+=e[d]);break;case"bg-w":b<2&&(c[a][b]+=e[d]);break;case"bg-s":a>1&&(c[a][b]+=e[d]);break;case"sm-n":a<1&&(c[a][b]+=e[d]);break;case"sm-e":b>2&&(c[a][b]+=e[d]);break;case"sm-w":b<1&&(c[a][b]+=e[d]);break;case"sm-s":a>2&&(c[a][b]+=e[d]);break;default:c[a][b]=8}return c}}function setSettings(){function a(a){d3.select(`#${a}`).property("checked")?sessionStorage.setItem(a,"true"):sessionStorage.removeItem(a)}a("formUseTimer"),a("formMarkSafe"),a("formGetBrand"),startPractice()}function setPractice(){let e,b=0,f,c,g,h,i,a=[-2,-1,1,2],j=[1,2,3,4];if(e=getRandItem(a),sessionStorage.getItem("formGetBrand"))for(b=getRandItem(a);e+b===0;)b=getRandItem(a);for(f=getRandItem(j),c=getRandItem(j);f===c;)c=getRandItem(j);g=shuffle(a);do{i=!1,h=shuffle(a);for(let d=0;d<a.length;d++)if(g[d]===h[d]){i=!0;break}}while(i)VIVI=new Vivi(e,b),ARENA=new Arena(f,c,g,h)}function startPractice(){hide("btnStartPractice"),showAll(["btnPractiseAgain","btnEditSettings"]),setPractice(),hide("settings"),show("info"),addOptions(),show("bosse"),sessionStorage.getItem("formUseTimer")?(SPEED=1e3,startMechanic("Hot and Cold")):(SPEED=1e3,showAll(["btnResolveSwords1","dbf-intemp",`dbf-eb${VIVI.brand}`]),VIVI.showLife(VIVI.bodyTemp),writeTempChange(VIVI.hotcold),ARENA.showClones(),ARENA.rotateBosses(1),ARENA.showSwords(1))}function resolveSwords1(){updateStatus(),ARENA.colorTiles(1),setTimeout(function(){hide("btnResolveSwords1"),VIVI.sword(1),100!==VIVI.bodyTemp&&VIVI.bodyTemp>= -2&&VIVI.bodyTemp<=2&&(ARENA.hideSwords(),ARENA.rotateBosses(2),ARENA.showSwords(2),show("btnResolveSwords2"))},SPEED)}function resolveSwords2(){updateStatus(),ARENA.colorTiles(2),setTimeout(function(){hide("btnResolveSwords2"),VIVI.sword(2),100!==VIVI.bodyTemp&&VIVI.bodyTemp>= -2&&VIVI.bodyTemp<=2&&(removeOptions(),ARENA.hideSwords(),sessionStorage.getItem("formGetBrand")?show("btnResolveBrand"):resolveBrand())},SPEED)}function resolveBrand(){hide("btnResolveBrand"),ARENA.hideClones(),VIVI.check(VIVI.brand),hide(`dbf-eb${VIVI.brand}`),0===VIVI.bodyTemp?VIVI.win():VIVI.dead()}function startTimerHotCold(){let a=0===VIVI.brand?42:49,b=(a="&nbsp;")=>write("txt-hotcold",a);b(a),timerHOTCOLD=setInterval(function(){switch(b(--a),a){case 0:clearInterval(timerHOTCOLD),b(),0===VIVI.bodyTemp?VIVI.win():VIVI.dead();break;case 4:ARENA.hideClones();break;case 7:removeOptions(),VIVI.sword(2);break;case 8:ARENA.colorTiles(2);break;case 17:startMechanic("Blade of Entropy",10),ARENA.showSwords(2);break;case 18:ARENA.rotateBosses(2);break;case 20:VIVI.sword(1);break;case 21:ARENA.colorTiles(1);break;case 30:startMechanic("Blade of Entropy",10),ARENA.showSwords(1);break;case 31:ARENA.rotateBosses(1);break;case 38:startMechanic("Unwavering Apparition");break;case 46:startMechanic("Elemental Brand")}},SPEED)}function startTimerBrand(){let a=38,b=VIVI.brand,c=(a="&nbsp;")=>write("txt-brand",a);c(a),show(`dbf-eb${b}`),timerBRAND=setInterval(function(){c(--a),a<=0&&(clearInterval(timerBRAND),c(),VIVI.check(b),(VIVI.bodyTemp>= -2||VIVI.bodyTemp<=2)&&hide(`dbf-eb${b}`))},SPEED)}function startMechanic(a,b=4){let c=`Casting <b>${a}</b> in... `;updateStatus(c+b),timerMECHANIC=setInterval(function(){if(--b<=0){switch(a){case"Blade of Entropy":ARENA.hideSwords();break;case"Unwavering Apparition":ARENA.showClones(),updateStatus();break;case"Elemental Brand":startTimerBrand(),updateStatus();break;case"Hot and Cold":startTimerHotCold(),show("dbf-intemp"),VIVI.showLife(VIVI.bodyTemp),writeTempChange(VIVI.hotcold)}clearInterval(timerMECHANIC)}else updateStatus(c+b)},SPEED)}function addOptions(){options(function(){VIVI.position=this.id,move("vivi-ans",40*VIVI.x+18,40*VIVI.y+16)})}function removeOptions(){options(null)}function options(c){for(let a=0;a<4;a++)for(let b=0;b<4;b++)d3.select(`#tile${a}${b}`).on("click",c)}function practiseAgain(){sessionStorage.setItem("practiseAgain","true"),location.reload()}function editSettings(){sessionStorage.setItem("editSettings","true"),location.reload()}function getRandItem(a){let b=Math.floor(Math.random()*a.length);return a[b]}function shuffle(d){let a=d.slice();for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1));[a[b],a[c]]=[a[c],a[b]]}return a}function move(a,b,c){d3.select(`#${a}`).attr("transform",`translate(${b}, ${c})`)}function hide(a){d3.select(`#${a}`).classed("hidden",!0)}function show(a){d3.select(`#${a}`).classed("hidden",!1)}function hideAll(a){for(let b of a)hide(b)}function showAll(a){for(let b of a)show(b)}function updateStatus(a="&nbsp;"){write("status",a)}function write(a,b="&nbsp;"){d3.select(`#${a}`).html(b)}function writeTempChange(a){let b,c,d;0!==a&&(c=a<0?"falls":"rises",a=Math.abs(a),d=a>1?"s":"",b=`<i>Your body temperature ${c} ${a} level${d}.</i>`),updateStatus(b)}function checkForm(a){let b=!!sessionStorage.getItem(a);d3.select(`#${a}`).property("checked",b)}window.onload=function(){sessionStorage.getItem("practiseAgain")?(sessionStorage.removeItem("practiseAgain"),startPractice()):(sessionStorage.getItem("editSettings")&&(sessionStorage.removeItem("editSettings"),checkForm("formUseTimer"),checkForm("formMarkSafe"),checkForm("formGetBrand")),sessionStorage.clear(),show("settings"))}