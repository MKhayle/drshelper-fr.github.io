<<<<<<< HEAD
"use strict";var c,d,e,f,g,h;const i=["vivi-win","vivi-dead"],j=["bosse","bossn","bossw","bosss"],k=["bossn","bossw","bosss"],l=["meter-2","meter-1","meter1","meter2"],m=["swordn","sworde","swordw","swords"],n={win:"You resolved everything correctly and lived! Great job!",dead:"You failed to neutralize your temperature and got KO\u2019d&nbsp;:(",sword:"You got hit by two swords at once!",burned:"Your body went above 2 levels and burned to death!",froze:"Your body went below 2 levels and froze to death!"};class o{constructor(a,b){this.hotcold=a,this.brand=b,this.body=a,this.pos="tile12",this.show()}set pos(a){this.tile=a,this.x=parseInt(a.slice(4,5)),this.y=parseInt(a.slice(5))}show(){J("vivi-ans"),J("vivi-south")}win(){I("vivi-south"),J("vivi-win")}dead(){I("vivi-south"),J("vivi-dead"),L("btnPractiseAgain")}move(a,b){H("vivi-ans",a,b)}sword(f){let a,b,c=this.x,e=this.y;1===f?(a=d.hits1,b=d.temps1):(a=d.hits2,b=d.temps2),a[e][c]>1?(B(),this.dead(),M("You got hit by two swords at once!")):this.check(b[e][c])}check(b){let a=this.body+b;a>2||a< -2?(B(),this.dead(),a>2?M("Your body went above 2 levels and burned to death!"):M("Your body went below 2 levels and froze to death!")):(this.life(a),this.body=a,O(b))}life(a){let b=this.body;J("ta-life"),K("dbf-hc"+b),K("life"+b),L("dbf-hc"+a),L("life"+a)}}class p{constructor(a,b,c,d){this.safe1=a,this.safe2=b,this.meters1=c,this.meters2=d,this.showSafe=G("formShowSafe"),this.init(),this.rotateAll(0)}init(){let[a,b]=[this.safe1,this.safe2],[c,d]=[this.meters1,this.meters2];this.orients1=this.setOrients(a),this.orients2=this.setOrients(b),this.swords1=this.setSwords(a),this.swords2=this.setSwords(b),this.hits1=this.setHits(a),this.hits2=this.setHits(b),this.temps1=this.setHits(a,c),this.temps2=this.setHits(b,d)}setOrients(a){let b=F("n","s"),c=F("e","w");return[3===a||4===a?b:c,2===a||3===a?b:c,1===a||4===a?b:c,1===a||2===a?b:c]}setSwords(b){let a=[];switch(b){case 1:a=["swordn","swords","swordw","sworde"];break;case 2:a=["swordn","sworde","swords","swordw"];break;case 3:a=["swordw","sworde","swordn","swords"];break;default:a=["sworde","swordn","swordw","swords"]}return a}setHits(g,e=[1,1,1,1]){let c=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],f=[];switch(g){case 1:f=["sm-n","bg-s","sm-w","bg-e"];break;case 2:f=["sm-n","sm-e","bg-s","bg-w"];break;case 3:f=["bg-w","sm-e","bg-n","sm-s"];break;default:f=["bg-e","bg-n","sm-w","sm-s"]}for(let a=0;a<c.length;a++)for(let b=0;b<c[a].length;b++)for(let d=0;d<f.length;d++)switch(f[d]){case"bg-n":a<2&&(c[a][b]+=e[d]);break;case"bg-e":b>1&&(c[a][b]+=e[d]);break;case"bg-w":b<2&&(c[a][b]+=e[d]);break;case"bg-s":a>1&&(c[a][b]+=e[d]);break;case"sm-n":a<1&&(c[a][b]+=e[d]);break;case"sm-e":b>2&&(c[a][b]+=e[d]);break;case"sm-w":b<1&&(c[a][b]+=e[d]);break;case"sm-s":a>2&&(c[a][b]+=e[d]);break;default:c[a][b]=8}return c}color(d,f=!1){let h=1===d?this.hits1:this.hits2,g,c;for(let a=0;a<4;a++)for(let b=0;b<4;b++){if(f)c="honeydew";else{if(0===(g=h[b][a]))continue;c=2===g?"sandybrown":"#fad2b0"}d3.select("#bg"+a+b).style("fill",c)}if(!f)return setTimeout(this.color,e,d,!0)}clones(){for(let a of k)J(a)}rotateAll(d=0){let a=[],c=["n","e","w","s"];switch(d){case 1:a=this.orients1;break;case 2:a=this.orients2;break;default:a=new Array(4).fill("s")}for(let b=0;b<c.length;b++)this.rotate(c[b],a[b])}rotate(b,c){let a;switch(c){case"n":a=180;break;case"e":a=270;break;case"w":a=90;break;default:a=0}d3.select("#face"+b).attr("transform","translate(17, 17) rotate("+a+") translate(-17, -17)")}meters(b){let a=1===b?this.meters1:this.meters2;for(let c of(H("meter"+a[0],73,26),H("meter"+a[1],113,66),H("meter"+a[2],33,66),H("meter"+a[3],73,106),l))J(c)}swords(f){let c,e,a,b;switch(1===f?(c=this.swords1,e=this.meters1):(c=this.swords2,e=this.meters2),c.indexOf("swordn")){case 0:[a,b]=[87,10.5];break;case 1:[a,b]=[127,50.5];break;default:[a,b]=[39,50.5]}switch(H("swordn",a,b),c.indexOf("sworde")){case 0:[a,b]=[95.5,39];break;case 1:[a,b]=[135.5,79];break;default:[a,b]=[95.5,127]}switch(H("sworde",a,b),c.indexOf("swordw")){case 0:[a,b]=[50.5,39];break;case 2:[a,b]=[10.5,79];break;default:[a,b]=[50.5,127]}switch(H("swordw",a,b),c.indexOf("swords")){case 1:[a,b]=[127,95.5];break;case 2:[a,b]=[39,95.5];break;default:[a,b]=[87,135.5]}H("swords",a,b);for(let d=0;d<m.length;d++)d3.select("#"+c[d]).styles({fill:e[d]>0?"#f08080":"#87cefa",stroke:e[d]>0?"#531515":"#4668a6"}),J(m[d])}}function q(){let g,b=0,h,e,i,j,k,a=[-2,-1,1,2],l=[1,2,3,4],n=d=>{let a=d.slice();for(let b=a.length-1;b>0;b--){let c=Math.floor(Math.random()*(b+1));[a[b],a[c]]=[a[c],a[b]]}return a};if(g=F(...a),G("formGetBrand"))for(b=F(...a);g+b===0;)b=F(...a);for(h=F(...l),e=F(...l);h===e;)e=F(...l);i=n(a);do{k=!1,j=n(a);for(let f=0;f<a.length;f++)if(i[f]===j[f]){k=!0;break}}while(k)for(let m of(c=new o(g,b),d=new p(h,e,i,j),K("dbf-intemp"),K("dbf-hc0"),K("life0"),a))K("dbf-hc"+m),K("dbf-eb"+m),K("life"+m)}function a(){q(),K("settings"),L("info"),x(),J("bosse"),G("formUseTimer")?(e=1e3,w("Hot and Cold")):(L("btnResolveSwords1"),L("dbf-intemp"),L("dbf-eb"+c.brand),c.life(c.body),O(c.hotcold),d.clones(),d.rotateAll(1),d.meters(1),d.swords(1))}function r(){M(),d.color(1),setTimeout(function(){K("btnResolveSwords1"),c.sword(1),c.body>= -2&&c.body<=2?(d.rotateAll(2),d.meters(2),d.swords(2),L("btnResolveSwords2")):L("btnPractiseAgain")},e)}function s(){M(),d.color(2),setTimeout(function(){K("btnResolveSwords2"),c.sword(2),c.body>= -2&&c.body<=2?(y(),E(l,m),L("btnResolveBrand")):L("btnPractiseAgain")},e)}function t(){let a=c.brand;K("btnResolveBrand"),L("btnPractiseAgain"),E(k),c.check(a),K("dbf-eb"+a),0===c.body?(c.win(),M("You resolved everything correctly and lived! Great job!")):(c.dead(),M("You failed to neutralize your temperature and got KO\u2019d&nbsp;:("))}function u(){let a=d3.select("#txt-hotcold"),b=0===c.brand?42:49;a.text(b),L("dbf-intemp"),c.life(c.body),f=setInterval(function(){switch(b--,a.text(b),b){case 0:clearInterval(f),a.html("&nbsp;"),0===c.body?(c.win(),M("You resolved everything correctly and lived! Great job!")):(c.dead(),M("You failed to neutralize your temperature and got KO\u2019d :("));break;case 7:y(),c.sword(2);break;case 8:d.color(2);break;case 17:w("Blade of Entropy",10),d.meters(2),d.swords(2);break;case 18:d.rotateAll(2);break;case 20:c.sword(1);break;case 21:d.color(1);break;case 30:w("Blade of Entropy",10),d.meters(1),d.swords(1);break;case 31:d.rotateAll(1);break;case 38:w("Unwavering Apparition");break;case 46:w("Elemental Brand")}},e)}function v(){let a=d3.select("#txt-brand"),b=38,d=c.brand;a.text(b),L("dbf-eb"+d),g=setInterval(function(){b--,a.text(b),b<=0&&(clearInterval(g),L("btnPractiseAgain"),c.check(d),(c.body>= -2||c.body<=2)&&(E(k),K("dbf-eb"+d),O(d)),a.html("&nbsp;"))},e)}function w(a,b=4){M("Casting <b>"+a+"</b> in... "+b),h=setInterval(function(){if(--b<=0){switch(a){case"Blade of Entropy":E(l,m);break;case"Unwavering Apparition":d.clones(),M();break;case"Elemental Brand":v(),M();break;case"Hot and Cold":u(),O(c.hotcold)}clearInterval(h)}else M("Casting <b>"+a+"</b> in... "+b)},e)}function x(){z(A)}function y(){z(null)}function z(c){for(let a=0;a<4;a++)for(let b=0;b<4;b++)d3.select("#tile"+a+b).on("click",c)}function A(){c.pos=this.id,c.move(40*c.x+18,40*c.y+16),c.show()}function B(){y(),clearInterval(f),d3.select("#txt-hotcold").html("&nbsp;"),clearInterval(g),d3.select("#txt-brand").html("&nbsp;"),clearInterval(h),D()}function C(){K("btnPractiseAgain"),B(),b(),a()}function D(){c="",d="",e=0,f="",g="",h=""}function E(...a){let d;for(let b of a)for(let c of b)I(c)}function F(...a){return a[Math.floor(Math.random()*a.length)]}function G(a){return d3.select("#"+a).property("checked")}function H(a,b,c){d3.select("#"+a).attr("transform","translate("+b+", "+c+")")}function I(a){d3.select("#"+a).classed("invisible",!0)}function J(a){d3.select("#"+a).classed("invisible",!1)}function K(a){d3.select("#"+a).classed("hidden",!0)}function L(a){d3.select("#"+a).classed("hidden",!1)}function M(a="&nbsp;"){N("status",a)}function N(a,b){d3.select("#"+a).html(b)}function O(b){let a;switch(b){case 0:M();return;case -2:a="falls 2 levels.";break;case -1:a="falls 1 level.";break;case 1:a="rises 1 level.";break;default:a="rises 2 levels."}M("<i>Your body temperature "+a+"</i>")}function b(){E(i,j,l,m)}b(),a()
=======
"use strict";var VIVI,ARENA,timerHOTCOLD,timerBRAND,timerDEBUFF,hasPICKED=!1,SPEED=1000;const VIVIS=["vivi-win","vivi-dead"],VIVIS2=["vivi-ans","vivi-win","vivi-dead","vivi-south"],TA=["bosse"],CLONES=["bossn","bossw","bosss"],BOSSES=TA.concat(CLONES),METERS=["meter-2","meter-1","meter1","meter2"],SWORDS=["swordn","sworde","swordw","swords"],SETTINGS={timer:!0,safe:!0,init:function(){this.timer=d3.select("#formTimer").property("checked"),this.safe=d3.select("#formSafe").property("checked"),this.timer,SPEED=1e3}};class Vivi{constructor(e,t){this.hotcold=e,this.brand=t,this.body=e,this.pos="tile12",this.show()}set pos(e){this.tile=e,this.x=parseInt(e.slice(4,5)),this.y=parseInt(e.slice(5))}show(){vis("vivi-ans"),vis("vivi-south")}win(){invis("vivi-south"),vis("vivi-win")}dead(){invis("vivi-south"),vis("vivi-dead"),show("btnPractiseAgain")}move(e,t){move("vivi-ans",e,t)}sword(e){let t,s,i=this.x,r=this.y;1===e?(t=ARENA.hits1,s=ARENA.temps1):(t=ARENA.hits2,s=ARENA.temps2),t[r][i]>1?(endPractice(),this.dead(),write("You got hit by two swords at once!")):this.check(s[r][i])}check(e){let t=this.body+e;t>2||t<-2?(endPractice(),this.dead(),write(t>2?"Your body went above 2 levels and burned to death!":"Your body went below 2 levels and froze to death!")):(this.life(t),this.body=t,levelTemp(e))}life(e){let t=this.body;vis("ta-life"),hide("dbf-hc"+t),hide("life"+t),show("dbf-hc"+e),show("life"+e)}}class Arena{constructor(e,t,s,i){this.safe1=e,this.safe2=t,this.meters1=s,this.meters2=i,this.showSafe=SETTINGS.safe,this.init(),this.rotateAll(0)}init(){let[e,t]=[this.safe1,this.safe2],[s,i]=[this.meters1,this.meters2];this.orients1=this.setOrients(e),this.orients2=this.setOrients(t),this.swords1=this.setSwords(e),this.swords2=this.setSwords(t),this.hits1=this.setHits(e),this.hits2=this.setHits(t),this.temps1=this.setHits(e,s),this.temps2=this.setHits(t,i)}setOrients(e){const t=(()=>getRand("n","s"))(),s=(()=>getRand("e","w"))();return[3===e||4===e?t:s,2===e||3===e?t:s,1===e||4===e?t:s,1===e||2===e?t:s]}setSwords(e){let t=[];switch(e){case 1:t=["swordn","swords","swordw","sworde"];break;case 2:t=["swordn","sworde","swords","swordw"];break;case 3:t=["swordw","sworde","swordn","swords"];break;case 4:default:t=["sworde","swordn","swordw","swords"]}return t}setHits(e,t=[1,1,1,1]){let s=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],i=[];switch(e){case 1:i=["sm-n","bg-s","sm-w","bg-e"];break;case 2:i=["sm-n","sm-e","bg-s","bg-w"];break;case 3:i=["bg-w","sm-e","bg-n","sm-s"];break;default:i=["bg-e","bg-n","sm-w","sm-s"]}for(let e=0;e<s.length;e++)for(let r=0;r<s[e].length;r++)for(let o=0;o<i.length;o++)switch(i[o]){case"bg-n":e<2&&(s[e][r]+=t[o]);break;case"bg-e":r>1&&(s[e][r]+=t[o]);break;case"bg-w":r<2&&(s[e][r]+=t[o]);break;case"bg-s":e>1&&(s[e][r]+=t[o]);break;case"sm-n":e<1&&(s[e][r]+=t[o]);break;case"sm-e":r>2&&(s[e][r]+=t[o]);break;case"sm-w":r<1&&(s[e][r]+=t[o]);break;case"sm-s":e>2&&(s[e][r]+=t[o]);break;default:s[e][r]=8}return s}color(e,t=!1){let s,i,r=1===e?this.hits1:this.hits2;for(let e=0;e<4;e++)for(let o=0;o<4;o++){if(t)i="honeydew";else{if(0===(s=r[o][e]))continue;i=2===s?"sandybrown":"#fad2b0"}d3.select("#bg"+e+o).style("fill",i)}if(!t)return setTimeout(this.color,SPEED,e,!0)}clones(){for(let e of CLONES)vis(e)}rotateAll(e=0){let t=[],s=["n","e","w","s"];switch(e){case 1:t=this.orients1;break;case 2:t=this.orients2;break;default:t=new Array(4).fill("s")}for(let e=0;e<s.length;e++)this.rotate(s[e],t[e])}rotate(e,t){let s;switch(t){case"n":s=180;break;case"e":s=270;break;case"w":s=90;break;case"s":default:s=0}d3.select("#face"+e).attr("transform","translate(17, 17) rotate("+s+") translate(-17, -17)")}meters(e){let t=1===e?this.meters1:this.meters2;move("meter"+t[0],73,26),move("meter"+t[1],113,66),move("meter"+t[2],33,66),move("meter"+t[3],73,106);for(let e of METERS)vis(e)}swords(e){let t,s,i,r;switch(1===e?(t=this.swords1,s=this.meters1):(t=this.swords2,s=this.meters2),t.indexOf("swordn")){case 0:[i,r]=[87,10.5];break;case 1:[i,r]=[127,50.5];break;default:[i,r]=[39,50.5]}switch(move("swordn",i,r),t.indexOf("sworde")){case 0:[i,r]=[95.5,39];break;case 1:[i,r]=[135.5,79];break;default:[i,r]=[95.5,127]}switch(move("sworde",i,r),t.indexOf("swordw")){case 0:[i,r]=[50.5,39];break;case 2:[i,r]=[10.5,79];break;default:[i,r]=[50.5,127]}switch(move("swordw",i,r),t.indexOf("swords")){case 1:[i,r]=[127,95.5];break;case 2:[i,r]=[39,95.5];break;default:[i,r]=[87,135.5]}move("swords",i,r);for(let e=0;e<SWORDS.length;e++)d3.select("#"+t[e]).styles({fill:s[e]>0?"#f08080":"#87cefa",stroke:s[e]>0?"#531515":"#4668a6"}),vis(SWORDS[e])}}function setGame(){let e,t,s,i,r,o,a;const n=[-2,-1,1,2],d=[1,2,3,4];function l(e){let t=e.slice();for(let e=t.length-1;e>0;e--){let s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}for(e=getRand(...n),t=getRand(...n);e+t===0;)t=getRand(...n);for(s=getRand(...d),i=getRand(...d);s===i;)i=getRand(...d);r=l(n);do{a=!1,o=l(n);for(let e=0;e<n.length;e++)if(r[e]===o[e]){a=!0;break}}while(a);VIVI=new Vivi(e,t),ARENA=new Arena(s,i,r,o),hide("dbf-intemp"),hide("dbf-hc0"),hide("life0");for(let e of n)hide("dbf-hc"+e),hide("dbf-eb"+e),hide("life"+e)}function startPractice(){SETTINGS.init(),setGame(),hide("settings"),show("info"),addOptions(),vis("bosse"),SETTINGS.timer?castDebuff("Hot and Cold"):(show("btnResolveSwords1"),show("dbf-intemp"),show("dbf-eb"+VIVI.brand),VIVI.life(VIVI.body),levelTemp(VIVI.hotcold),ARENA.clones(),ARENA.rotateAll(1),ARENA.meters(1),ARENA.swords(1))}function btnResolveSwords1(){write(),ARENA.color(1),setTimeout(function(){hide("btnResolveSwords1"),VIVI.sword(1),VIVI.body>=-2&&VIVI.body<=2?(ARENA.rotateAll(2),ARENA.meters(2),ARENA.swords(2),show("btnResolveSwords2")):show("btnPractiseAgain")},SPEED)}function btnResolveSwords2(){write(),ARENA.color(2),setTimeout(function(){hide("btnResolveSwords2"),VIVI.sword(2),VIVI.body>=-2&&VIVI.body<=2?(removeOptions(),resetThis(METERS,SWORDS),show("btnResolveBrand")):show("btnPractiseAgain")},SPEED)}function btnResolveBrand(){let e=VIVI.brand;hide("btnResolveBrand"),show("btnPractiseAgain"),resetThis(CLONES),VIVI.check(e),hide("dbf-eb"+e),0===VIVI.body?(VIVI.win(),write("You resolved everything correctly and lived! Great job!")):(VIVI.dead(),write("You failed to neutralize your temperature and got KO’d&nbsp;:("))}function startTimerHotCold(){let e=d3.select("#txt-hotcold"),t=49;e.text(t),show("dbf-intemp"),VIVI.life(VIVI.body),timerHOTCOLD=setInterval(function(){switch(t--,e.text(t),t){case 0:clearInterval(timerHOTCOLD),e.html("&nbsp;"),0===VIVI.body?(VIVI.win(),write("You resolved everything correctly and lived! Great job!")):(VIVI.dead(),write("You failed to neutralize your temperature and got KO’d :("));break;case 7:removeOptions(),VIVI.sword(2);break;case 8:ARENA.color(2);break;case 17:castDebuff("Blade of Entropy",10),ARENA.meters(2),ARENA.swords(2);break;case 18:ARENA.rotateAll(2);break;case 20:VIVI.sword(1);break;case 21:ARENA.color(1);break;case 30:castDebuff("Blade of Entropy",10),ARENA.meters(1),ARENA.swords(1);break;case 31:ARENA.rotateAll(1);break;case 38:castDebuff("Unwavering Apparition");break;case 46:castDebuff("Elemental Brand")}},SPEED)}function startTimerBrand(){let e=d3.select("#txt-brand"),t=38,s=VIVI.brand;e.text(t),show("dbf-eb"+s),timerBRAND=setInterval(function(){t--,e.text(t),t<=0&&(clearInterval(timerBRAND),show("btnPractiseAgain"),VIVI.check(s),(VIVI.body>=-2||VIVI.body<=2)&&(resetThis(CLONES),hide("dbf-eb"+s),levelTemp(s)),e.html("&nbsp;"))},SPEED)}function castDebuff(e,t=4){write("Casting <b>"+e+"</b> in... "+t),timerDEBUFF=setInterval(function(){if(--t<=0){switch(e){case"Blade of Entropy":resetThis(METERS,SWORDS);break;case"Unwavering Apparition":ARENA.clones(),write();break;case"Elemental Brand":startTimerBrand(),write();break;case"Hot and Cold":startTimerHotCold(),levelTemp(VIVI.hotcold)}clearInterval(timerDEBUFF)}else write("Casting <b>"+e+"</b> in... "+t)},SPEED)}function addOptions(){options(clickTile)}function removeOptions(){options(null)}function options(e){for(let t=0;t<4;t++)for(let s=0;s<4;s++)d3.select("#tile"+t+s).on("click",e)}function clickTile(){VIVI.pos=this.id,VIVI.move(40*VIVI.x+18,40*VIVI.y+16),VIVI.show(),hasPICKED=!0}function endPractice(){removeOptions(),clearInterval(timerHOTCOLD),d3.select("#txt-hotcold").html("&nbsp;"),clearInterval(timerBRAND),d3.select("#txt-brand").html("&nbsp;"),clearInterval(timerDEBUFF),resetGlobals()}function practiseAgain(){hide("btnPractiseAgain"),endPractice(),resetBoard(),startPractice()}function resetGlobals(){VIVI="",ARENA="",timerHOTCOLD="",timerBRAND="",timerDEBUFF="",hasPICKED=!1}function resetThis(...e){let t;for(let s of e){t=s;for(let e of t)invis(e)}}function getRand(...e){return e[Math.floor(Math.random()*e.length)]}function move(e,t,s){d3.select("#"+e).attr("transform","translate("+t+", "+s+")")}function invis(e){d3.select("#"+e).classed("invisible",!0)}function vis(e){d3.select("#"+e).classed("invisible",!1)}function hide(e){d3.select("#"+e).classed("hidden",!0)}function show(e){d3.select("#"+e).classed("hidden",!1)}function write(e="&nbsp;"){d3.select("#status").html(e)}function levelTemp(e){let t;switch(e){case 0:return void write();case-2:t="falls 2 levels.";break;case-1:t="falls 1 level.";break;case 1:t="rises 1 level.";break;case 2:default:t="rises 2 levels."}write("<i>Your body temperature "+t+"</i>")}function resetBoard(){resetThis(VIVIS,BOSSES,METERS,SWORDS)}resetBoard(),startPractice();
>>>>>>> parent of 9267662 (Minor code cleanup)
